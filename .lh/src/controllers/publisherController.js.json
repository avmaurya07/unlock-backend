{
    "sourceFile": "src/controllers/publisherController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1766923456501,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766924388561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,18 +1,31 @@\n const Publisher = require(\"../models/Publisher\");\n+const PublisherType = require(\"../models/PublisherType\");\n \n // CREATE Publisher Onboarding\n exports.createPublisher = async (req, res) => {\n   try {\n     const { publisherType, companyName, website, description, address } = req.body;\n \n-    // Check if onboarding already done\n+    // Validate publisher type\n+    const typeExists = await PublisherType.findOne({\n+      _id: publisherType,\n+      isActive: true\n+    });\n+\n+    if (!typeExists) {\n+      return res.status(400).json({\n+        success: false,\n+        message: \"Invalid or inactive publisher type\"\n+      });\n+    }\n+\n+    // Check if user already onboarded\n     const existing = await Publisher.findOne({ userId: req.user.id });\n-\n     if (existing) {\n       return res.status(400).json({\n         success: false,\n-        message: \"Publisher profile already exists\",\n+        message: \"Publisher profile already exists\"\n       });\n     }\n \n     // Start 15-day free trial\n@@ -31,79 +44,93 @@\n     });\n \n     res.json({\n       success: true,\n-      message: \"Publisher profile created successfully\",\n-      publisher,\n+      message: \"Publisher onboarding completed\",\n+      publisher\n     });\n \n   } catch (error) {\n     res.status(500).json({\n       success: false,\n-      message: \"Server error creating publisher profile\",\n-      error: error.message,\n+      message: \"Server error in onboarding\",\n+      error: error.message\n     });\n   }\n };\n \n \n-\n // GET Logged-in Publisher Profile\n exports.getMyPublisherProfile = async (req, res) => {\n   try {\n-    const publisher = await Publisher.findOne({ userId: req.user.id });\n+    const publisher = await Publisher.findOne({ userId: req.user.id })\n+      .populate(\"publisherType\", \"name description\");\n \n     if (!publisher) {\n       return res.status(404).json({\n         success: false,\n-        message: \"Publisher profile not found\",\n+        message: \"Publisher profile not found\"\n       });\n     }\n \n     res.json({\n       success: true,\n-      publisher,\n+      publisher\n     });\n \n   } catch (error) {\n     res.status(500).json({\n       success: false,\n-      message: \"Server error fetching publisher profile\",\n-      error: error.message,\n+      message: \"Server error loading profile\",\n+      error: error.message\n     });\n   }\n };\n \n \n-\n // UPDATE Publisher Profile\n exports.updatePublisher = async (req, res) => {\n   try {\n     const updates = req.body;\n \n+    // If publisherType is passed â†’ validate\n+    if (updates.publisherType) {\n+      const validType = await PublisherType.findOne({\n+        _id: updates.publisherType,\n+        isActive: true\n+      });\n+\n+      if (!validType) {\n+        return res.status(400).json({\n+          success: false,\n+          message: \"Invalid or inactive publisher type\"\n+        });\n+      }\n+    }\n+\n     const publisher = await Publisher.findOneAndUpdate(\n       { userId: req.user.id },\n       updates,\n       { new: true }\n-    );\n+    ).populate(\"publisherType\");\n \n     if (!publisher) {\n       return res.status(404).json({\n         success: false,\n-        message: \"Publisher profile not found\",\n+        message: \"Publisher profile not found\"\n       });\n     }\n \n     res.json({\n       success: true,\n       message: \"Profile updated successfully\",\n-      publisher,\n+      publisher\n     });\n \n   } catch (error) {\n     res.status(500).json({\n       success: false,\n-      message: \"Server error updating profile\",\n-      error: error.message,\n+      message: \"Error updating profile\",\n+      error: error.message\n     });\n   }\n };\n"
                }
            ],
            "date": 1766923456501,
            "name": "Commit-0",
            "content": "const Publisher = require(\"../models/Publisher\");\n\n// CREATE Publisher Onboarding\nexports.createPublisher = async (req, res) => {\n  try {\n    const { publisherType, companyName, website, description, address } = req.body;\n\n    // Check if onboarding already done\n    const existing = await Publisher.findOne({ userId: req.user.id });\n\n    if (existing) {\n      return res.status(400).json({\n        success: false,\n        message: \"Publisher profile already exists\",\n      });\n    }\n\n    // Start 15-day free trial\n    const expiry = new Date();\n    expiry.setDate(expiry.getDate() + 15);\n\n    const publisher = await Publisher.create({\n      userId: req.user.id,\n      publisherType,\n      companyName,\n      website,\n      description,\n      address,\n      subscriptionStatus: \"active\",\n      subscriptionExpiry: expiry,\n    });\n\n    res.json({\n      success: true,\n      message: \"Publisher profile created successfully\",\n      publisher,\n    });\n\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Server error creating publisher profile\",\n      error: error.message,\n    });\n  }\n};\n\n\n\n// GET Logged-in Publisher Profile\nexports.getMyPublisherProfile = async (req, res) => {\n  try {\n    const publisher = await Publisher.findOne({ userId: req.user.id });\n\n    if (!publisher) {\n      return res.status(404).json({\n        success: false,\n        message: \"Publisher profile not found\",\n      });\n    }\n\n    res.json({\n      success: true,\n      publisher,\n    });\n\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Server error fetching publisher profile\",\n      error: error.message,\n    });\n  }\n};\n\n\n\n// UPDATE Publisher Profile\nexports.updatePublisher = async (req, res) => {\n  try {\n    const updates = req.body;\n\n    const publisher = await Publisher.findOneAndUpdate(\n      { userId: req.user.id },\n      updates,\n      { new: true }\n    );\n\n    if (!publisher) {\n      return res.status(404).json({\n        success: false,\n        message: \"Publisher profile not found\",\n      });\n    }\n\n    res.json({\n      success: true,\n      message: \"Profile updated successfully\",\n      publisher,\n    });\n\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Server error updating profile\",\n      error: error.message,\n    });\n  }\n};\n"
        }
    ]
}